<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Album Tier List</title>
        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Font Awesome Icons -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />
        <!-- Custom CSS -->
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div class="container my-5">
            <!-- Access Control Section -->
            <div id="password-section" class="row justify-content-center mb-4">
                <div class="col-md-6">
                    <div class="input-group">
                        <input
                            type="password"
                            id="password-input"
                            class="form-control"
                            placeholder="Enter password to enable editing"
                        />
                        <button id="login-btn" class="btn btn-primary">
                            Login
                        </button>
                    </div>
                </div>
            </div>

            <!-- Global Search (visible to everyone) + top actions for admins -->
            <div class="row justify-content-center mb-3">
                <div class="col-12">
                    <div
                        class="d-flex gap-2 align-items-center"
                        id="search-container"
                    >
                        <input
                            id="search-input"
                            class="form-control flex-grow-1"
                            placeholder="Search albums by title or artist"
                            type="text"
                            aria-label="Search albums"
                        />
                        <div
                            id="top-actions"
                            class="d-flex gap-2"
                            style="display: none"
                        >
                            <button
                                id="export-png-btn"
                                class="btn btn-outline-light"
                            >
                                <i class="fas fa-download me-1"></i>Export
                            </button>
                            <button
                                id="logout-btn"
                                class="btn btn-outline-warning"
                            >
                                <i class="fas fa-sign-out-alt me-1"></i>Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Album Section (Hidden by default) -->
            <div id="edit-section" class="mb-4" style="display: none">
                <h3 class="text-center">Add an Album</h3>
                <div class="input-group mb-3">
                    <input
                        type="text"
                        id="spotify-link-input"
                        class="form-control"
                        placeholder="Paste a Spotify Album Link"
                    />
                    <button id="add-album-btn" class="btn btn-success">
                        Add to Queue
                    </button>
                </div>
                <!-- Admin toolbar removed; actions moved next to search -->
            </div>

            <div id="tier-board">
                <!-- Album Queue -->
                <div class="tier" id="album-queue">
                    <div class="tier-label-container tier-label-queue">
                        <button
                            id="random-queue-btn"
                            class="btn btn-sm ms-3"
                            title="Pick random from queue"
                        >
                            <i class="fas fa-dice"></i>
                        </button>
                    </div>
                    <div id="queue-container" class="tier-dropzone">
                        <!-- Albums waiting to be tiered will appear here -->
                    </div>
                </div>

                <!-- Tier List Grid -->
                <main id="tier-list-container">
                    <!-- Tiers (ðŸ and S to F) will be dynamically generated here by JavaScript -->
                </main>
            </div>
        </div>

        <!-- Album Details Modal -->
        <div
            class="modal fade"
            id="albumModal"
            tabindex="-1"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header border-secondary">
                        <h5 class="modal-title" id="albumModalLabel">
                            Album Details
                        </h5>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="d-flex gap-3 align-items-start mb-3">
                            <img
                                id="modal-art"
                                src=""
                                alt="Album Art"
                                width="140"
                                height="140"
                                class="rounded"
                            />
                            <div>
                                <h4 id="modal-title" class="mb-1"></h4>
                                <div
                                    id="modal-artist"
                                    class="text-muted mb-2"
                                ></div>
                                <div id="modal-meta" class="small"></div>
                                <a
                                    id="modal-spotify-link"
                                    href="#"
                                    target="_blank"
                                    rel="noopener"
                                    class="btn btn-success btn-sm mt-2"
                                    >Open in Spotify</a
                                >
                            </div>
                        </div>
                        <h6>Tracks</h6>
                        <ol id="modal-tracks"></ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toasts -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div
                id="undoToast"
                class="toast text-bg-dark border-secondary"
                role="alert"
                aria-live="assertive"
                aria-atomic="true"
            >
                <div
                    class="toast-body d-flex justify-content-between align-items-center"
                >
                    <span>Album deleted</span>
                    <button
                        id="undo-delete-btn"
                        type="button"
                        class="btn btn-outline-light btn-sm"
                    >
                        Undo
                    </button>
                </div>
            </div>
        </div>

        <!-- Firebase -->
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

        <!-- SortableJS for Drag-and-Drop -->
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

        <!-- Bootstrap JS (for Modal/Toasts) -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

        <!-- html2canvas for PNG export -->
        <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

        <!-- Custom JavaScript -->
        <script src="app.js"></script>
    </body>
</html>
